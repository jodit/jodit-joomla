"use strict";((e,t)=>{if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var o=t();for(var n in o)("object"==typeof exports?exports:e)[n]=o[n]}})(self,(function(){return(self.webpackChunkjodit_pro=self.webpackChunkjodit_pro||[]).push([[633],{212(e,t,o){o.r(t),o.d(t,{autocomplete:()=>v});var n=o(187),s=o(62),i=o(2),r=o(19),l=o(10),u=o(4),c=o(37);class a extends c.u1{constructor(e,t){var o;super(e),this.item=t;const{container:n}=this;if((0,l.isFunction)(t.itemRenderer)){const e=t.itemRenderer(t);(0,l.isString)(e)?n.innerHTML=e:n.appendChild(e)}else n.innerText=null!==(o=t.title)&&void 0!==o?o:t.value}className(){return"AutocompleteItem"}}let p=class extends c.qe{constructor(){super(...arguments),this.elements=[],this.currentSelection=-1}className(){return"Autocomplete"}onChangeSelection(e,t){var o;null!=t&&(null===(o=this.elements[t])||void 0===o||o.setMod("active",!1)),this.elements[this.currentSelection].setMod("active",!0),this.elements[this.currentSelection].container.scrollIntoView(!1)}build(e){this.clear(),e.forEach(((e,t)=>{const o=new a(this.jodit,e);this.j.e.on(o.container,"mousedown touchstart",(e=>{e.preventDefault()})).on(o.container,"click",(()=>{this.currentSelection=t,this.select()})),this.append(o)})),this.currentSelection=0,this.onChangeSelection()}selectNext(){this.currentSelection+1>this.elements.length-1?this.currentSelection=0:this.currentSelection+=1}selectPrevious(){0>this.currentSelection-1?this.currentSelection=this.elements.length-1:this.currentSelection-=1}select(){this.j.e.fire("select.autocomplete",this.elements[this.currentSelection].item)}};(0,n.gn)([(0,r.watch)("currentSelection")],p.prototype,"onChangeSelection",null),p=(0,n.gn)([r.component],p);var d=o(3),h=o(1),m=o(17),f=o(88);i.D.prototype.autocomplete={sources:[],maxItems:50,isMatchedQuery:(e,t)=>0===t.toLowerCase().indexOf(e.toLowerCase()),itemRenderer(e){var t;return null!==(t=e.title)&&void 0!==t?t:e.value},insertValueRenderer:e=>e.value+"&nbsp;"};class v extends s.S{constructor(){super(...arguments),this.requires=["enter","license"],this.hasStyle=!h.Jodit.fatMode,this.sources=[]}afterInit(e){this.popup=new u.Popup(e),this.popup.setMod("padding",!1),this.list=new p(e),this.popup.setContent(this.list.container),e.e.on("select.autocomplete",(t=>{let o=t.value;(0,l.isFunction)(t.insertValueRenderer)&&(o=t.insertValueRenderer(t)),u.Dom.isNode(o)||(o=e.createInside.fromHTML(o)),((e,t)=>{var o;const{startContainer:n,startOffset:s}=e;if(m.i.isText(n)){const i=null!==(o=n.nodeValue)&&void 0!==o?o:"",r=i.substr(0,s),l=i.substr(s),u=r.split(" ");u[u.length-1]="";const c=u.join(" ");n.nodeValue=c+l,e.setStart(n,c.length),e.insertNode(t)}})(e.s.range,o),this.j.s.setCursorAfter(o),this.popup.close()})).on("keydown.autocomplete",this.onKeyDown).on("keydown.autocomplete",this.onKeyControlDown,void 0,!0).on("beforeEnter.autocomplete",this.onEnter,void 0,!0).on("autocomplete.autocomplete",this.onAutoComplete).on("registerAutocompleteSource.autocomplete",this.registerAutocompleteSource)}registerAutocompleteSource(e){this.sources.push(e)}static isControlKey(e){return e===d.KEY_DOWN||e===d.KEY_UP||e===d.KEY_ENTER||e===d.KEY_TAB}async onKeyDown(e){var t;if(e.key===d.KEY_ESC)return void(this.popup.isOpened&&this.popup.close());if(v.isControlKey(e.key)||!this.j.s.isCollapsed)return;const o=null===(t=this.j.s.sel)||void 0===t?void 0:t.getRangeAt(0);if(!o||!u.Dom.isOrContains(this.j.editor,o.startContainer))return;const n=(e=>{var t,o,n,s;const{startContainer:i,startOffset:r}=e;if(m.i.isText(i))return null!==(o=null===(t=i.nodeValue)||void 0===t?void 0:t.substr(0,r))&&void 0!==o?o:"";const l=i.childNodes[r];if(!l)return"";if(m.i.isText(l))return null!==(n=l.nodeValue)&&void 0!==n?n:"";const u=(0,f.tT)(l,!0,i);return m.i.isText(u)&&null!==(s=l.nodeValue)&&void 0!==s?s:""})(o).split(" ").pop();if(n&&(0,l.trim)(n).length){const e=await this.onAutoComplete(n);if(e.length)return this.openPopup(e)}this.popup.isOpened&&this.popup.close()}onKeyControlDown(e){if(this.popup.isOpened&&v.isControlKey(e.key)){switch(e.key){case d.KEY_DOWN:this.list.selectNext();break;case d.KEY_UP:this.list.selectPrevious();break;case d.KEY_TAB:this.list.select()}return this.j.e.stopPropagation(e.type),!1}}onEnter(){if(this.popup.isOpened)return this.list.select(),!1}async onAutoComplete(e){const t=[];return await Promise.all(this.sources.concat(this.j.o.autocomplete.sources).map((async o=>{t.push(...await this.resolveFeed(e,o))}))),t}async resolveFeed(e,t,o){let n;if((0,l.isPromise)(t)&&(t=await t),(0,l.isFunction)(t))n=await t(e);else if((0,l.isArray)(t)){const o=t,{isMatchedQuery:s}=this.j.o.autocomplete;n=o.filter((t=>(0,l.isString)(t)?s(e,t):s(e,t.value))).map((e=>(0,l.isString)(e)?{title:e,value:e}:e))}else n=await this.resolveFeed(e,t.feed,t);if(n&&(0,l.isArray)(n)){const{itemRenderer:e,insertValueRenderer:t,maxItems:s}=this.j.o.autocomplete;return n=n.map((n=>{var s,i;return{itemRenderer:null!==(s=null==o?void 0:o.itemRenderer)&&void 0!==s?s:e,insertValueRenderer:null!==(i=null==o?void 0:o.insertValueRenderer)&&void 0!==i?i:t,...n}})),n.slice(0,s)}return[]}openPopup(e){this.list.build(e),this.popup.open((()=>this.j.s.range.getBoundingClientRect()))}beforeDestruct(e){e.e.off(this.list).off("keydown.autocomplete",this.onKeyDown).off("autocomplete.autocomplete",this.onAutoComplete).off(".autocomplete"),this.list.destruct(),this.popup.destruct()}}(0,n.gn)([r.autobind],v.prototype,"registerAutocompleteSource",null),(0,n.gn)([(0,r.debounce)()],v.prototype,"onKeyDown",null),(0,n.gn)([r.autobind],v.prototype,"onKeyControlDown",null),(0,n.gn)([r.autobind],v.prototype,"onEnter",null),(0,n.gn)([r.autobind],v.prototype,"onAutoComplete",null),(0,n.gn)([r.autobind],v.prototype,"resolveFeed",null),h.Jodit.plugins.add("autocomplete",v)},187(e,t,o){function n(e,t,o,n){var s,i=arguments.length,r=3>i?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(r=(3>i?s(r):i>3?s(t,o,r):s(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r}o.d(t,{gn:()=>n})}},e=>e(e.s=212)])}));